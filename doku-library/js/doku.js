/**
 * Created by DOKU on 3/31/16.
 */

function getForm(e){console.log(e);var t=new Object;t.req_merchant_code=e.req_merchant_code,t.req_transaction_id=e.req_transaction_id,t.req_payment_channel=e.req_payment_channel,t.req_chain_merchant=e.req_chain_merchant,t.req_amount=e.req_amount,t.req_currency=e.req_currency,t.req_words=e.req_words,t.req_form_type=e.req_form_type,t.req_domain_valid=document.location.origin,void 0!=e.req_customer_id&&""!=e.req_customer_id&&(t.req_customer_id=e.req_customer_id),void 0!=e.req_token_payment&&""!=e.req_token_payment&&(t.req_token_payment=e.req_token_payment);var r=$("[doku-div='form-payment']").html();doku_timeout=setTimeout(function(){$("[doku-div='form-payment']").html("<br><center><span id='doku-loader-text'>TIMEOUT</span><br><br><a id='doku-retry-button' href='#!' onclick='getForm("+JSON.stringify(e)+")'>Try again</a></center><br>"),doku_ajax.abort()},65e3),doku_ajax=$.ajax({url:requestURL+"getRequestCode",data:{data:JSON.stringify(t)},dataType:"json",type:"POST",beforeSend:function(){$("[doku-div='form-payment']").html("<br><center><img src='"+loadingUrl+"' class='doku-loader-image'></center><br>")}}).success(function(t){if(console.log(t),clearTimeout(doku_timeout),$("[doku-div='form-payment']").html(r),"0000"==t.res_response_code){if("inline"==e.req_form_type)if(data_obj=$.extend(e,t),void 0==e.req_custom_form)for(i=0;i<Object.size(t.res_form_payment);i++)$("[doku-div='form-payment']").prepend(t.res_form_payment[i]);else{if("15"==e.req_payment_channel){for(i=0;i<e.req_custom_form.length;i++)$("#"+e.req_custom_form[i]).prepend(t.res_form_payment[i]);e.req_custom_form.length<5&&(frmSaveToken=t.res_form_payment[4]),"true"==t.res_service_two_click?void 0!=e.req_token_payment&&""!=e.req_token_payment&&void 0!=t.res_tokenization?(tokenization=$.parseJSON(t.res_tokenization),console.log(tokenization),console.log(t.res_form_payment[2]),$("#doku-cc-number").val(tokenization.res_cc_number),$("#doku-cc-number").addClass("readonlycase"),$("#doku-cc-number").prop("disabled","disabled"),$("#doku-cc-number").removeAttr("validation-rules"),$("#doku-cc-exp").addClass("readonlycase"),$("#doku-cc-exp").prop("disabled","disabled"),$("#doku-cc-exp").removeAttr("validation-rules"),$("#doku-name-cc").addClass("readonlycase"),$("#doku-name-cc").prop("disabled","disabled"),$("#doku-name-cc").removeAttr("validation-rules"),$(".doku-cvc").payment("formatCardCVC")):($("[doku-div='form-payment']").append(frmSaveToken),$("[doku-div='form-payment']").after("<br>"),$(".doku-cc-number").payment("formatCardNumber"),$(".doku-cc-exp").payment("formatCardExpiry"),$(".doku-cvc").payment("formatCardCVC")):($(".doku-cc-number").payment("formatCardNumber"),$(".doku-cc-exp").payment("formatCardExpiry"),$(".doku-cvc").payment("formatCardCVC"))}else for(i=0;i<e.req_custom_form.length;i++)$("#"+e.req_custom_form[i]).prepend(t.res_form_payment[i]);btnOnBlur()}else if("full"==e.req_form_type){e=$.extend(e,t),console.log(t.res_form_payment),$("[doku-div='form-payment']").html(t.res_form_payment),$(".amount").text(parseInt(e.req_amount).format(0,3,".",",")),"15"==e.req_payment_channel&&("true"==t.res_service_two_click?void 0!=e.req_token_payment&&""!=e.req_token_payment&&void 0!=t.res_tokenization?(tokenization=$.parseJSON(t.res_tokenization),console.log(tokenization),$("#doku-cc-number").val(tokenization.res_cc_number),$("#doku-cc-number").addClass("readonlycase"),$("#doku-cc-number").prop("disabled","disabled"),$("#doku-cc-number").removeAttr("validation-rules"),$("#doku-li-save-cc").remove(),$("#doku-div-name-cc").remove(),$("#doku-div-cc-exp").remove()):($(".doku-cc-number").payment("formatCardNumber"),$(".doku-cc-exp").payment("formatCardExpiry"),$(".doku-cvc").payment("formatCardCVC")):($("#doku-li-save-cc").hide(),$(".doku-cc-number").payment("formatCardNumber"),$(".doku-cc-exp").payment("formatCardExpiry"),$(".doku-cvc").payment("formatCardCVC"))),btnOnBlur();var o=$("input[type='button']").map(function(){return this.id}).get();for(i=0;i<o.length;i++)$("#"+o[i]).click(function(){delete e[0],formatForm($.extend($(this).parents("form"),$.extend(e,t)))})}}else $("[doku-div='form-payment']").html("<br><center><span id='doku-loader-text'>Request failed... error code : "+t.res_response_code.replace(new RegExp("_","g")," ")+"</span><br><br><a id='doku-retry-button' href='#!' onclick='getForm("+JSON.stringify(e)+")'>Try again</a></center><br>")})}function btnOnBlur(){var e=$("input").not("[type='button']").map(function(){return this.id}).get();for(i=0;i<e.length;i++)$("#"+e[i]).blur(function(){if(void 0!=$(this).attr("validation-rules")){var e,t=$(this).attr("validation-rules").split("|");for(j=0;j<t.length;j++){var e=checkRules(this.id,t[j]);if(0==e)break}0==e?$(this).parent().addClass("has-error"):$(this).parent().removeClass("has-error")}})}function formatForm(e){var t=$("#"+e[0].id+" :input").not("[type='button']").map(function(){return this.id}).get(),r=validateForm(t);if(console.log(r),r){var o=new Object;o.req_input_form=t,o.req_pairing_code=e.res_request_code,o.req_server_url=e.req_server_url,o.req_loading=e.res_form_loading,o.req_result=e.res_form_result,submitForm($.extend(e,o))}}function validateForm(e){var t=!0;for(i=0;i<e.length;i++)if(void 0!=$("#"+e[i]).attr("validation-rules")){var r,o=$("#"+e[i]).attr("validation-rules").split("|");for(j=0;j<o.length;j++){var r=checkRules(e[i],o[j]);if(0==r)break}0==r&&($("#"+e[i]).parent().addClass("has-error"),t=!1)}return t}function checkRules(e,t){var r=!0,o=t;switch(o.indexOf("maxlength")>-1&&(o="maxlength"),o){case"required":""==$("#"+e).val()&&(r=!1);break;case"maxlength":var n=t.split(":");$("#"+e).val().length>n[1]&&(r=!1);break;case"cc":$.payment.validateCardNumber($("#"+e).val())||(r=!1);break;case"cc-cvc":$.payment.validateCardCVC($("#"+e).val())||(r=!1);break;case"cc-exp":if(void 0!=$("#"+e).val()){var a=$("#"+e).val().split(" / ");$.payment.validateCardExpiry(a[0],a[1])?a[1].length<4&&(r=!1):r=!1}break;case"number":1==isNaN($("#"+e).val())&&(r=!1);break;case"email":var i=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;r=i.test($("#"+e).val())}return r}function receiveMessage(e){e.origin==originUrl&&(threeDResponse=e.data,$.fancybox.close())}function submitForm(e){var t=processForm(e);$("[doku-div='form-payment']").html(e.req_loading),doku_timeout=setTimeout(function(){e.form_req_result_note="Timeout",showResult(e),doku_ajax.abort()},65e3),doku_ajax=$.ajax({url:requestURL+"getToken",data:{data:JSON.stringify(t)},dataType:"json",type:"POST"}).success(function(r){clearTimeout(doku_timeout),console.log("submitForm"),console.log(r),"0000"==r.res_response_code?"04"==e.req_payment_channel?initiateFormWallet($.extend(e,$.extend(t,r))):void 0!=r.res_result_3D?(obj3D=JSON.parse(r.res_result_3D),window.addEventListener("message",receiveMessage,!1),$.fancybox.open([{closeClick:!1,type:"iframe",openEffect:"fade",closeEffect:"fade",openSpeed:"slow",closeSpeed:"slow",content:form3D,closeBtn:!1,autoResize:!0,helpers:{overlay:{closeClick:!1}},afterClose:function(){obj3dResponse=$.parseJSON(threeDResponse),"0000"==obj3dResponse.res_response_code?backToMerchant($.extend(e,$.extend(t,r))):(e.form_req_result_note=obj3dResponse.res_response_code,showResult(e))}}]),$("#doku-form-3d").find("#PaReq").val(obj3D.PAREQ),$("#doku-form-3d").find("#MD").val(obj3D.MD),$("#doku-form-3d").find("#TermUrl").val(obj3D.TERMURL),$("#doku-form-3d").attr("action",obj3D.ACSURL),$("#doku-form-3d").submit()):backToMerchant($.extend(e,$.extend(t,r))):(e.form_req_result_note=r.res_response_code,showResult(e))})}function processForm(e){var t=new Object;if(t.req_merchant_code=e.req_merchant_code,t.req_payment_channel=e.req_payment_channel,t.req_transaction_id=e.req_transaction_id,t.req_amount=e.req_amount,t.req_currency=e.req_currency,t.req_pairing_code=e.req_pairing_code,t.req_access_type="W",t.req_domain_valid=document.location.origin,"15"==e.req_payment_channel){if(void 0!=e.req_customer_id&&""!=e.req_customer_id){if(void 0==e.res_tokenization){e.form_req_date=$("#doku-cc-exp").val(),e.form_req_number=$("#doku-cc-number").val();var r=e.form_req_date.split(" / ");t.req_date=r[1].substring(2,4)+r[0],t.req_number=e.form_req_number.replace(/ - /g,""),t.req_name=$("#doku-name-cc").val()}1==$("#doku-save-cc").prop("checked")?t.req_save_customer="SAVE":t.req_save_customer="UNSAVE"}else{e.form_req_date=$("#"+e.req_input_form[3]).val(),e.form_req_number=$("#"+e.req_input_form[0]).val();var r=e.form_req_date.split(" / ");t.req_date=r[1].substring(2,4)+r[0],t.req_number=e.form_req_number.replace(/ - /g,""),t.req_name=$("#"+e.req_input_form[2]).val()}t.req_secret=$("#doku-cvc").val()}else"04"==e.req_payment_channel&&(t.req_doku_id=$("#"+e.req_input_form[0]).val(),t.req_doku_pass=$("#"+e.req_input_form[1]).val(),t.req_session_id=e.req_session_id,t.req_chain_merchant=e.req_chain_merchant);return t}function backToMerchant(e){console.log("backToMerchant"),console.log(e);var t={doku_token:e.res_token_id,doku_pairing_code:e.req_pairing_code,doku_invoice_no:e.req_transaction_id,doku_amount:e.req_amount,doku_chain_merchant:e.req_chain_merchant,doku_currency:e.req_currency,doku_mall_id:e.req_merchant_code};console.log(e.req_server_url),console.log(t),$.ajax({url:e.req_server_url,data:t,type:"POST"}).success(function(t){console.log(t);var r=JSON.parse(t);"15"==e.req_payment_channel?"0000"!=r.res_response_code?(e.form_req_result_note=r.res_response_code,showResult(e)):1==r.res_show_doku_page?($("[doku-div='form-payment']").html(e.req_result),$(".success").show(),$(".fail").remove(),$("doku-approval-code").html(r.res_approval_code),$("doku-card-number").html(r.res_mcn),$("doku-invoice-number").html(r.res_trans_id_merchant),$("doku-amount").html(r.res_amount),void 0!=r.res_redirect_url?($("div.detail-result").children("a").attr("href","#!"),$("div.detail-result").children("a").attr("onclick","window.location = '"+r.res_redirect_url+"';")):$("div.detail-result").children("a").remove()):window.location=r.res_redirect_url:"04"==e.req_payment_channel&&("0000"!=r.res_response_code?(e.form_req_result_note=r.res_response_code,showResult(e)):1==r.res_show_doku_page?($("[doku-div='form-payment']").html(e.req_result),$(".success").show(),$(".fail").remove(),$("doku-approval-code").html(r.res_approval_code),$("doku-invoice-number").html(e.req_transaction_id),void 0!=r.res_card_number?$("doku-card-number").html(r.res_card_number):$("doku-card-number").parent().parent().remove(),void 0!=r.promotion?(objPromotion=JSON.parse(r.promotion),$("doku-amount").html(parseInt(e.req_amount)-parseInt(objPromotion.amount))):$("doku-amount").html(e.req_amount),void 0!=r.res_redirect_url?($("div.detail-result").children("a").attr("href","#!"),$("div.detail-result").children("a").attr("onclick","window.location = '"+r.res_redirect_url+"';")):$("div.detail-result").children("a").remove()):window.location=r.res_redirect_url)})}function initiateFormWallet(e){if("0000"==e.res_response_code){$("[doku-div='form-payment']").html(e.res_form_payment_dw),$("#respTabs").responsiveTabs(),$(".resp-tabDrop").wrap("<div class='selectdw'><div class='wrapper-select'></div></div>"),$("input[name$='optdw']").click(function(){var e=$(this).val();$("div.promocontent-dw").hide(),$("#"+e).show()}),$(".amount").text(parseInt(e.req_amount).format(0,3,".",","));JSON.parse(e.res_data_dw);formatWalletCash(e),formatWalletCc(e),btnOnBlur();var t=$("input[type='button']").map(function(){return this.id}).get();for(i=0;i<t.length;i++)$("#"+t[i]).click(function(){delete e[0],formatFormWallet($.extend($(this).parents("form"),e))})}else e.form_req_result_note=e.res_response_code,showResult(e)}function formatWalletCash(e){var t=JSON.parse(e.res_data_dw);if($(".nameuser").text(t.customerName),$(".saldo").text(t.listPaymentChannel[0].details.lastBalance.format(0,3,".",",")),$(".amount-payment").text(parseInt(e.req_amount).format(0,3,".",",")),$(".amount-discount").text(parseInt("0").format(0,3,".",",")),$(".amount-total").text(parseInt(e.req_amount).format(0,3,".",",")),void 0!=t.listPromotion&&t.listPromotion.length>0){for(i=0;i<t.listPromotion.length;i++)$("#doku-voucher").append('<option value="'+t.listPromotion[i].id+'">'+t.listPromotion[i].amount+"</option>");$("#doku-voucher").change(function(){$(".amount-discount").text(parseInt("0").format(0,3,".",","))}),$("#doku-voucher").change(function(){""!=$("option:selected",this).val()&&($(".amount-discount").text(parseInt($("option:selected",this).text()).format(0,3,".",",")),parseInt(e.req_amount)-parseInt($("option:selected",this).text())<0?$(".amount-total").text(0):$(".amount-total").text(parseInt(parseInt(e.req_amount)-parseInt($("option:selected",this).text())).format(0,3,".",",")))}),$("#voucher_check").change(function(){1==$(this).prop("checked")?""!=$("#doku-voucher :selected").val()&&($(".amount-discount").text(parseInt($("#doku-voucher :selected").text()).format(0,3,".",",")),$(".amount-total").text(parseInt(parseInt(e.req_amount)-parseInt($("#doku-voucher :selected").text())).format(0,3,".",","))):($(".amount-discount").text(parseInt("0").format(0,3,".",",")),$(".amount-total").text(parseInt(e.req_amount).format(0,3,".",",")))})}else $("#doku-voucher-div").remove(),$("#doku-voucher-value").remove(),$("#doku-total-payment").remove()}function formatWalletCc(e){var t=JSON.parse(e.res_data_dw);if(void 0==t.listPaymentChannel[1].details)$("#frmcc").remove(),$(".doku-cc-number").payment("formatCardNumber"),$(".doku-cc-exp").payment("formatCardExpiry"),$(".doku-cvc").payment("formatCardCVC");else{$("#frmcc-manual").remove();var r="";for(i=0;i<t.listPaymentChannel[1].details.length;i++)0==i?(r=document.getElementById("listcard"+i).outerHTML,$("#r0").attr("checked",!0)):$("#listcard"+(i-1)).after(r.replace(new RegExp("0","g"),i)),"4"==t.listPaymentChannel[1].details[i].cardNoMasked.substring(0,1)?$("#type-cc"+i).addClass("visa"):"5"==t.listPaymentChannel[1].details[i].cardNoMasked.substring(0,1)&&$("#type-cc"+i).addClass("mastercard"),$("#doku-cc-number"+i).text(t.listPaymentChannel[1].details[i].cardNoMasked)}}function formatFormWallet(e){var t=$("#"+e[0].id+" :input").not("[type='button']").map(function(){return this.id}).get(),r=validateForm(t);if(r)if("frmcash"==e[0].id)e.req_pin=$("#"+t[t.length-1]).val(),submitFormWallet(e);else if("frmcc"==e[0].id)e.req_cvv=$("#"+t[t.length-1]).val(),e.req_cc_id=$("#"+e[0].id+" :input[type='radio']").map(function(){return 1==$(this).prop("checked")?this.id:void 0}).get()[0],submitFormWallet(e);else{var o=$("#"+t[1]).val().split(" / ");e.req_wallet_form={CC_NAME:$("#"+t[2]).val(),CC_CARDNUMBER:$("#"+t[0]).val().replace(/ - /g,""),CC_EXPIRYDATE:o[1].substring(2,4)+o[0],CC_MOBILEPHONE:$("#"+t[3]).val(),CC_EMAIL:$("#"+t[4]).val(),CC_CVV:$("#"+t[t.length-1]).val()},submitFormWallet(e)}}function submitFormWallet(e){var t=JSON.parse(e.res_data_dw),r=new Object;r.req_token_id=e.res_token_id,r.req_pairing_code=e.req_pairing_code,r.req_words=e.req_words,r.req_domain_valid=document.location.origin,"frmcash"==e[0].id?(r.req_dokuwallet={req_channel_code:t.listPaymentChannel[0].channelCode,req_customer_pin:e.req_pin,req_inquiry_code:t.inquiryCode,req_customer_name:t.customerName,req_customer_email:t.customerEmail,req_doku_id:t.dokuId},1==$("#voucher_check").prop("checked")&&""!=$("#doku-voucher :selected").val()&&(r.req_dokuwallet.req_promotion_id=$("#doku-voucher :selected").val())):"frmcc"==e[0].id?r.req_dokuwallet={req_channel_code:t.listPaymentChannel[1].channelCode,req_inquiry_code:t.inquiryCode,req_doku_id:t.dokuId,req_link_id:t.listPaymentChannel[1].details[e.req_cc_id.substring(1,2)].linkId,req_number:t.listPaymentChannel[1].details[e.req_cc_id.substring(1,2)].cardNoEncrypt,req_date:t.listPaymentChannel[1].details[e.req_cc_id.substring(1,2)].cardExpiryDateEncrypt,req_cvv:e.req_cvv}:(r.req_dokuwallet=e.req_wallet_form,r.req_dokuwallet.req_channel_code=t.listPaymentChannel[1].channelCode,r.req_dokuwallet.req_inquiry_code=t.inquiryCode,r.req_dokuwallet.req_doku_id=t.dokuId),console.log(r),$("[doku-div='form-payment']").html(e.req_loading),doku_timeout=setTimeout(function(){e.form_req_result_note="Timeout",showResult(e),doku_ajax.abort()},65e3),doku_ajax=$.ajax({url:requestURL+"PrePayment",data:{data:JSON.stringify(r)},dataType:"json",type:"POST"}).success(function(t){clearTimeout(doku_timeout),"0000"==t.res_response_code?void 0!=t.res_result_3D?(obj3D=JSON.parse(t.res_result_3D),window.addEventListener("message",receiveMessage,!1),$.fancybox.open([{closeClick:!1,type:"iframe",openEffect:"fade",closeEffect:"fade",openSpeed:"slow",closeSpeed:"slow",content:form3D,closeBtn:!1,autoResize:!0,helpers:{overlay:{closeClick:!1}},afterClose:function(){obj3dResponse=$.parseJSON(threeDResponse),"0000"==obj3dResponse.res_response_code?backToMerchant($.extend(e,$.extend(r,t))):(e.form_req_result_note=obj3dResponse.res_response_code,showResult(e))}}]),$("#doku-form-3d").find("#PaReq").val(obj3D.PAREQ),$("#doku-form-3d").find("#MD").val(obj3D.MD),$("#doku-form-3d").find("#TermUrl").val(obj3D.TERMURL),$("#doku-form-3d").attr("action",obj3D.ACSURL),$("#doku-form-3d").submit()):backToMerchant($.extend(e,$.extend(r,t))):(e.form_req_result_note=t.res_response_code,showResult(e))})}function showResult(e){console.log("showResult"),console.log(e),$("[doku-div='form-payment']").html(e.req_result),$(".fail").show(),$(".success").remove(),$("doku-approval-code").parent().parent().remove(),$("doku-card-number").parent().parent().remove(),$("doku-invoice-number").html(e.req_transaction_id),$("doku-amount").html(e.req_amount),$("doku-message").html("Error code : "+e.form_req_result_note.replace(new RegExp("_","g")," ")),$("div.detail-result").children("a").attr("href","#!"),$("div.detail-result").children("a").html("Try Again"),e.retry=1,$("div.detail-result").children("a").attr("onclick","getForm("+JSON.stringify(e)+")")}function DokuToken(e){if("15"==data_obj.req_payment_channel)var t=["doku-cc-exp","doku-cc-number","doku-name-cc","doku-cvc"];else if("04"==data_obj.req_payment_channel)var t=["doku-username","doku-password"];var r=validateFormInline(t);if(r){$.fancybox.open([{closeClick:!1,type:"html",openEffect:"fade",closeEffect:"fade",openSpeed:"slow",closeSpeed:"slow",content:"<center><br><img src='"+loadingUrl+"' class='doku-loader-logo'><br><br><span class='doku-loader-text'>Please wait... your request is being processed</span></center>",closeBtn:!1,helpers:{overlay:{closeClick:!1}}}]);var o=formatFormInline();doku_timeout=setTimeout(function(){$.fancybox.open([{closeClick:!1,type:"html",openEffect:"fade",closeEffect:"fade",openSpeed:"slow",closeSpeed:"slow",content:"<center><br><img width='10%' src='"+failedUrl+"' class='doku-failed-logo'><br><br><span class='doku-loader-text'>Request failed... Timeout</span><br><br><a href='#!' class='doku-btn-retry' onclick='closePopup(); $(\"#"+t[0]+"\").focus();'>Try Again</a></center>",closeBtn:!1,helpers:{overlay:{closeClick:!1}}}]),doku_ajax.abort()},65e3),doku_ajax=$.ajax({url:requestURL+"getToken",data:{data:JSON.stringify(o)},dataType:"json",type:"POST"}).success(function(e){for(clearTimeout(doku_timeout),i=0;i<t.length;i++)$("#"+t[i]).val("");"0000"==e.res_response_code?processInlineForm(e):(console.log(e),$.fancybox.open([{closeClick:!1,type:"html",openEffect:"fade",closeEffect:"fade",openSpeed:"slow",closeSpeed:"slow",content:"<center><br><img width='10%' src='"+failedUrl+"' class='doku-failed-logo'><br><br><span class='doku-loader-text'>Request failed... error code : "+e.res_response_code.replace(new RegExp("_","g")," ")+"</span><br><br><a href='#!' class='doku-btn-retry' onclick='closePopup(); $(\"#"+t[0]+"\").focus();'>Try Again</a></center>",closeBtn:!1,helpers:{overlay:{closeClick:!1}}}]))})}}function closePopup(){$.fancybox.close()}function validateFormInline(e){var t=!0;for(i=0;i<e.length;i++)if(void 0!=$("#"+e[i]).attr("validation-rules")){var r,o=$("#"+e[i]).attr("validation-rules").split("|");for(j=0;j<o.length;j++){var r=checkRules(e[i],o[j]);if(0==r)break}0==r&&($("#"+e[i]).parent().addClass("has-error"),t=!1)}return t}function formatFormInline(){var e=new Object;if(e.req_merchant_code=data_obj.req_merchant_code,e.req_payment_channel=data_obj.req_payment_channel,e.req_transaction_id=data_obj.req_transaction_id,e.req_amount=data_obj.req_amount,e.req_currency=data_obj.req_currency,e.req_pairing_code=data_obj.res_request_code,e.req_access_type="W",e.req_domain_valid=document.location.origin,"15"==data_obj.req_payment_channel){if(void 0!=data_obj.req_customer_id&&""!=data_obj.req_customer_id){if(void 0==data_obj.res_tokenization){var t=$("#doku-cc-exp").val(),r=$("#doku-cc-number").val(),o=t.split(" / ");e.req_date=o[1].substring(2,4)+o[0],e.req_number=r.replace(/ - /g,""),e.req_name=$("#doku-name-cc").val()}1==$("#doku-save-cc").prop("checked")?e.req_save_customer="SAVE":e.req_save_customer="UNSAVE"}else{var t=$("#doku-cc-exp").val(),r=$("#doku-cc-number").val(),o=t.split(" / ");e.req_date=o[1].substring(2,4)+o[0],e.req_number=r.replace(/ - /g,""),e.req_name=$("#doku-name-cc").val()}e.req_secret=$("#doku-cvc").val()}else"04"==data_obj.req_payment_channel&&(e.req_doku_id=$("#doku-username").val(),e.req_doku_pass=$("#doku-password").val(),e.req_session_id=data_obj.req_session_id,e.req_chain_merchant=data_obj.req_chain_merchant);return e}function processInlineForm(e){console.log("processInlineForm"),console.log(e),"15"==data_obj.req_payment_channel?(e.res_pairing_code=data_obj.res_request_code,e.res_invoice_no=data_obj.req_transaction_id,e.res_amount=data_obj.req_amount,e.res_chain_merchant=data_obj.req_chain_merchant,e.res_currency=data_obj.req_currency,e.res_mall_id=data_obj.req_merchant_code,$("#doku-cc-exp").val(""),$("#doku-cc-number").val(""),$("#doku-name-cc").val(""),$("#doku-cvc").val(""),void 0!=e.res_result_3D?(obj3D=JSON.parse(e.res_result_3D),window.addEventListener("message",receiveMessage,!1),$.fancybox.open([{closeClick:!1,type:"iframe",content:form3D,closeBtn:!1,autoResize:!0,helpers:{overlay:{closeClick:!1}},afterClose:function(){obj3dResponse=$.parseJSON(threeDResponse),e=$.extend(e,obj3dResponse),getToken(e)}}]),$("#doku-form-3d").find("#PaReq").val(obj3D.PAREQ),$("#doku-form-3d").find("#MD").val(obj3D.MD),$("#doku-form-3d").find("#TermUrl").val(obj3D.TERMURL),$("#doku-form-3d").attr("action",obj3D.ACSURL),$("#doku-form-3d").submit()):getToken(e)):"04"==data_obj.req_payment_channel&&formatInlineFormDW(e)}function formatInlineFormDW(e){if("0000"==e.res_response_code){console.log($.parseJSON(e.res_data_dw)),$.fancybox.open([{closeClick:!1,type:"html",openEffect:"fade",closeEffect:"fade",openSpeed:"slow",closeSpeed:"slow",wrapCSS:"doku-wrap",content:e.res_form_payment_dw,helpers:{overlay:{closeClick:!1}}}]),$("#respTabs").responsiveTabs(),$(".resp-tabDrop").wrap("<div class='selectdw'><div class='wrapper-select'></div></div>"),$("input[name$='optdw']").click(function(){var e=$(this).val();$("div.promocontent-dw").hide(),$("#"+e).show()}),formatWalletCashInline(JSON.parse(e.res_data_dw)),formatWalletCcInline(JSON.parse(e.res_data_dw)),btnOnBlur();var t=$(".fancybox-wrap").find("input[type='button']").map(function(){return this.id}).get();for(i=0;i<t.length;i++)$("#"+t[i]).click(function(){formatFormWalletInline($.extend($(this).parents("form"),e))})}else getToken(e)}function formatWalletCashInline(e){if($(".nameuser").text(e.customerName),$(".saldo").text(e.listPaymentChannel[0].details.lastBalance.format(0,3,".",",")),$(".amount-payment").text(parseInt(data_obj.req_amount).format(0,3,".",",")),$(".amount-discount").text(parseInt("0").format(0,3,".",",")),$(".amount-total").text(parseInt(data_obj.req_amount).format(0,3,".",",")),void 0!=e.listPromotion&&e.listPromotion.length>0){for(i=0;i<e.listPromotion.length;i++)$("#doku-voucher").append('<option value="'+e.listPromotion[i].id+'">'+e.listPromotion[i].amount+"</option>");$("#doku-voucher").change(function(){$(".amount-discount").text(parseInt("0").format(0))}),$("#doku-voucher").change(function(){""!=$("option:selected",this).val()&&($(".amount-discount").text(parseInt($("option:selected",this).text()).format(0,3,".",",")),parseInt(frmObj.req_amount)-parseInt($("option:selected",this).text())<0?$(".amount-total").text(0):$(".amount-total").text(parseInt(parseInt(frmObj.req_amount)-parseInt($("option:selected",this).text())).format(0,3,".",",")))}),$("#voucher_check").change(function(){1==$(this).prop("checked")?""!=$("#doku-voucher :selected").val()&&($(".amount-discount").text(parseInt($("#doku-voucher :selected").text()).format(0,3,".",",")),$(".amount-total").text(parseInt(parseInt(data_obj.req_amount)-parseInt($("#doku-voucher :selected").text())).format(0,3,".",","))):($(".amount-discount").text(parseInt("0").format(0,3,".",",")),$(".amount-total").text(parseInt(data_obj.req_amount).format(0,3,".",",")))})}else $("#doku-voucher-div").remove(),$("#doku-voucher-value").remove(),$("#doku-total-payment").remove()}function formatWalletCcInline(e){if(void 0==e.listPaymentChannel[1].details)$("#frmcc").remove(),$(".doku-cc-number").payment("formatCardNumber"),$(".doku-cc-exp").payment("formatCardExpiry"),$(".doku-cvc").payment("formatCardCVC");else{$("#frmcc-manual").remove();var t="";for(i=0;i<e.listPaymentChannel[1].details.length;i++)0==i?(t=document.getElementById("listcard"+i).outerHTML,$("#r0").attr("checked",!0)):$("#listcard"+(i-1)).after(t.replace(new RegExp("0","g"),i)),"4"==e.listPaymentChannel[1].details[i].cardNoMasked.substring(0,1)?$("#type-cc"+i).addClass("visa"):"5"==e.listPaymentChannel[1].details[i].cardNoMasked.substring(0,1)&&$("#type-cc"+i).addClass("mastercard"),$("#doku-cc-number"+i).text(e.listPaymentChannel[1].details[i].cardNoMasked)}}function formatFormWalletInline(e){var t=$("#"+e[0].id+" :input").not("[type='button']").map(function(){return this.id}).get(),r=validateForm(t);if(console.log(r),r)if("frmcash"==e[0].id)e.req_pin=$("#"+t[t.length-1]).val(),submitFormWalletInline(e);else if("frmcc"==e[0].id)e.req_cvv=$("#"+t[t.length-1]).val(),e.req_cc_id=$("#"+e[0].id+" :input[type='radio']").map(function(){return 1==$(this).prop("checked")?this.id:void 0}).get()[0],submitFormWalletInline(e);else{var o=$("#"+t[1]).val().split(" / ");e.req_wallet_form={CC_NAME:$("#"+t[2]).val(),CC_CARDNUMBER:$("#"+t[0]).val().replace(/ - /g,""),CC_EXPIRYDATE:o[1].substring(2,4)+o[0],CC_MOBILEPHONE:$("#"+t[3]).val(),CC_EMAIL:$("#"+t[4]).val(),CC_CVV:$("#"+t[t.length-1]).val()},submitFormWalletInline(e)}}function submitFormWalletInline(e){var t=JSON.parse(e.res_data_dw),r=new Object;r.req_token_id=e.res_token_id,r.req_pairing_code=data_obj.res_request_code,r.req_words=data_obj.req_words,r.req_domain_valid=document.location.origin,"frmcash"==e[0].id?(r.req_dokuwallet={req_channel_code:t.listPaymentChannel[0].channelCode,req_customer_pin:e.req_pin,req_inquiry_code:t.inquiryCode,req_customer_name:t.customerName,req_customer_email:t.customerEmail,req_doku_id:t.dokuId},1==$("#voucher_check").prop("checked")&&""!=$("#doku-voucher :selected").val()&&(r.req_dokuwallet.req_promotion_id=$("#doku-voucher :selected").val())):"frmcc"==e[0].id?r.req_dokuwallet={req_channel_code:t.listPaymentChannel[1].channelCode,req_inquiry_code:t.inquiryCode,req_doku_id:t.dokuId,req_link_id:t.listPaymentChannel[1].details[e.req_cc_id.substring(1,2)].linkId,req_number:t.listPaymentChannel[1].details[e.req_cc_id.substring(1,2)].cardNoEncrypt,req_date:t.listPaymentChannel[1].details[e.req_cc_id.substring(1,2)].cardExpiryDateEncrypt,req_cvv:e.req_cvv}:(r.req_dokuwallet=e.req_wallet_form,r.req_dokuwallet.req_channel_code=t.listPaymentChannel[1].channelCode,r.req_dokuwallet.req_inquiry_code=t.inquiryCode,r.req_dokuwallet.req_doku_id=t.dokuId),console.log(r),doku_timeout=setTimeout(function(){$.fancybox.open([{closeClick:!1,type:"html",openEffect:"fade",closeEffect:"fade",openSpeed:"slow",closeSpeed:"slow",content:"<center><br><img width='10%' src='"+failedUrl+"' class='doku-failed-logo'><br><br><span class='doku-loader-text'>Request failed... Timeout</span><br><br><a href='#!' class='doku-btn-retry' onclick='closePopup();'>Try Again</a></center>",closeBtn:!1,helpers:{overlay:{closeClick:!1}}}]),doku_ajax.abort()},65e3),doku_ajax=$.ajax({url:requestURL+"PrePayment",data:{data:JSON.stringify(r)},dataType:"json",type:"POST",beforeSend:function(){$.fancybox.open([{closeClick:!1,type:"html",openEffect:"fade",closeEffect:"fade",openSpeed:"slow",closeSpeed:"slow",content:"<center><br><img src='"+loadingUrl+"' class='doku-loader-logo'><br><br><span class='doku-loader-text'>Please wait... your request is being processed</span></center>",closeBtn:!1,helpers:{overlay:{closeClick:!1}}}])}}).success(function(t){clearTimeout(doku_timeout),console.log("submitFormWalletInline"),console.log(t),"0000"==t.res_response_code?void 0!=t.res_result_3D?(obj3D=JSON.parse(t.res_result_3D),window.addEventListener("message",receiveMessage,!1),$.fancybox.open([{closeClick:!1,type:"iframe",content:form3D,closeBtn:!1,autoResize:!0,helpers:{overlay:{closeClick:!1}},afterClose:function(){obj3dResponse=$.parseJSON(threeDResponse),t.res_token_id=e.res_token_id,t.res_pairing_code=data_obj.res_request_code,t.res_invoice_no=data_obj.req_transaction_id,t.res_amount=data_obj.req_amount,t.res_chain_merchant=data_obj.req_chain_merchant,t.res_currency=data_obj.req_currency,t.res_mall_id=data_obj.req_merchant_code,delete t.res_result_3D,obj=$.extend(t,obj3dResponse),console.log("prepayment 3d"),console.log(obj),getToken(obj)}}]),$("#doku-form-3d").find("#PaReq").val(obj3D.PAREQ),$("#doku-form-3d").find("#MD").val(obj3D.MD),$("#doku-form-3d").find("#TermUrl").val(obj3D.TERMURL),$("#doku-form-3d").attr("action",obj3D.ACSURL),$("#doku-form-3d").submit()):(t.res_token_id=e.res_token_id,t.res_pairing_code=data_obj.res_request_code,t.res_invoice_no=data_obj.req_transaction_id,t.res_amount=data_obj.req_amount,t.res_chain_merchant=data_obj.req_chain_merchant,t.res_currency=data_obj.req_currency,t.res_mall_id=data_obj.req_merchant_code,getToken(t)):$.fancybox.open([{closeClick:!1,type:"html",openEffect:"fade",closeEffect:"fade",openSpeed:"slow",closeSpeed:"slow",content:"<center><br><img width='10%' src='"+failedUrl+"' class='doku-failed-logo'><br><br><span class='doku-loader-text'>Request failed... error code : "+t.res_response_code+"</span><br><br><a href='#!' class='doku-btn-retry' onclick='closePopup();'>Try Again</a></center>",closeBtn:!1,helpers:{overlay:{closeClick:!1}}}])})}function dokuMandiriInitiate(e){$("#"+e.req_cc_field).focusout(function(){for(var t=$("#cc_number").val(),r="",o=!1,n=0;n<t.length;n++)t.charAt(n)>="0"&&t.charAt(n)<="9"&&(r+=t.charAt(n));for(var a=0,i=1;i<=r.length;i++){var s=r.charAt(r.length-i);if(i%2==0){var c=2*s;c>9?(a+=1,a+=c%10-0):a+=c-0}else a+=s-0}a%10||(o=!0),o&&($("#"+e.req_cc_field).removeClass("error"),$("#"+e.req_challenge_field).val($("#cc_number").val().replace(/ - /g,"").substr(6,16)))})}var requestURL="http://staging.doku.com/api/payment/",originUrl="http://staging.doku.com",loadingUrl="http://staging.doku.com/doku-js/assets/images/loading.gif",failedUrl="http://staging.doku.com/doku-js/assets/images/failed.png",form3D='<form method="post" name="doku-form-3d" id="doku-form-3d" target=\'doku-iframe\'><input name="PaReq" type="hidden" id="PaReq"/><input name="MD" type="hidden" id="MD"/><input name="TermUrl" type="hidden" id="TermUrl"/>'+"</form><iframe name='doku-iframe' height='500' width='500'></iframe>",threeDResponse,data_obj,doku_timeout,doku_ajax,frmSaveToken;Number.prototype.format=function(e,t,r,o){var n="\\d(?=(\\d{"+(t||3)+"})+"+(e>0?"\\D":"$")+")",a=this.toFixed(Math.max(0,~~e));return(o?a.replace(".",o):a).replace(new RegExp(n,"g"),"$&"+(r||","))},Object.size=function(e){var t,r=0;for(t in e)e.hasOwnProperty(t)&&r++;return r},function(){var e,t,r,o,n,a,i,s,c,l,d,u,m,_,p,f,h,v,$,k,g,b,y,q,C=[].slice,x=[].indexOf||function(e){for(var t=0,r=this.length;r>t;t++)if(t in this&&this[t]===e)return t;return-1};e=window.jQuery||window.Zepto||window.$,e.payment={},
    e.payment.fn={},e.fn.payment=function(){var t,r;return r=arguments[0],t=2<=arguments.length?C.call(arguments,1):[],e.payment.fn[r].apply(this,t)},n=/(\d{1,4})/g,e.payment.cards=o=[{type:"visaelectron",patterns:[4026,417500,4405,4508,4844,4913,4917],format:n,length:[16],cvcLength:[3],luhn:!0},{type:"maestro",patterns:[5018,502,503,56,58,639,6220,67],format:n,length:[12,13,14,15,16,17,18,19],cvcLength:[3],luhn:!0},{type:"forbrugsforeningen",patterns:[600],format:n,length:[16],cvcLength:[3],luhn:!0},{type:"dankort",patterns:[5019],format:n,length:[16],cvcLength:[3],luhn:!0},{type:"visa",patterns:[4],format:n,length:[13,16],cvcLength:[3],luhn:!0},{type:"mastercard",patterns:[51,52,53,54,55,22,23,24,25,26,27],format:n,length:[16],cvcLength:[3],luhn:!0},{type:"amex",patterns:[34,37],format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:[15],cvcLength:[3,4],luhn:!0},{type:"dinersclub",patterns:[30,36,38,39],format:/(\d{1,4})(\d{1,6})?(\d{1,4})?/,length:[14],cvcLength:[3],luhn:!0},{type:"discover",patterns:[60,64,65,622],format:n,length:[16],cvcLength:[3],luhn:!0},{type:"unionpay",patterns:[62,88],format:n,length:[16,17,18,19],cvcLength:[3],luhn:!1},{type:"jcb",patterns:[35],format:n,length:[16],cvcLength:[3],luhn:!0}],t=function(e){var t,r,n,a,i,s,c,l;for(e=(e+"").replace(/\D/g,""),a=0,s=o.length;s>a;a++)for(t=o[a],l=t.patterns,i=0,c=l.length;c>i;i++)if(n=l[i],r=n+"",e.substr(0,r.length)===r)return t},r=function(e){var t,r,n;for(r=0,n=o.length;n>r;r++)if(t=o[r],t.type===e)return t},m=function(e){var t,r,o,n,a,i;for(o=!0,n=0,r=(e+"").split("").reverse(),a=0,i=r.length;i>a;a++)t=r[a],t=parseInt(t,10),(o=!o)&&(t*=2),t>9&&(t-=9),n+=t;return n%10===0},u=function(e){var t;return null!=e.prop("selectionStart")&&e.prop("selectionStart")!==e.prop("selectionEnd")?!0:null!=("undefined"!=typeof document&&null!==document&&null!=(t=document.selection)?t.createRange:void 0)&&document.selection.createRange().text?!0:!1},y=function(e,t){var r,o,n;try{r=t.prop("selectionStart")}catch(a){o=a,r=null}return n=t.val(),t.val(e),null!==r&&t.is(":focus")?(r===n.length&&(r=e.length),t.prop("selectionStart",r),t.prop("selectionEnd",r)):void 0},v=function(e){var t,r,o,n,a,i,s,c;for(null==e&&(e=""),o="０１２３４５６７８９",n="0123456789",i="",t=e.split(""),s=0,c=t.length;c>s;s++)r=t[s],a=o.indexOf(r),a>-1&&(r=n[a]),i+=r;return i},h=function(t){return setTimeout(function(){var r,o;return r=e(t.currentTarget),o=r.val(),o=v(o),o=o.replace(/\D/g,""),y(o,r)})},p=function(t){return setTimeout(function(){var r,o;return r=e(t.currentTarget),o=r.val(),o=v(o),o=e.payment.formatCardNumber(o),y(o,r)})},s=function(r){var o,n,a,i,s,c,l;return a=String.fromCharCode(r.which),!/^\d+$/.test(a)||(o=e(r.currentTarget),l=o.val(),n=t(l+a),i=(l.replace(/\D/g,"")+a).length,c=16,n&&(c=n.length[n.length.length-1]),i>=c||null!=o.prop("selectionStart")&&o.prop("selectionStart")!==l.length)?void 0:(s=n&&"amex"===n.type?/^(\d{4}|\d{4}\s\d{6})$/:/(?:^|\s)(\d{4})$/,s.test(l)?(r.preventDefault(),setTimeout(function(){return o.val(l+" "+a)})):s.test(l+a)?(r.preventDefault(),setTimeout(function(){return o.val(l+a+" ")})):void 0)},a=function(t){var r,o;return r=e(t.currentTarget),o=r.val(),8!==t.which||null!=r.prop("selectionStart")&&r.prop("selectionStart")!==o.length?void 0:/\d\s$/.test(o)?(t.preventDefault(),setTimeout(function(){return r.val(o.replace(/\d\s$/,""))})):/\s\d?$/.test(o)?(t.preventDefault(),setTimeout(function(){return r.val(o.replace(/\d$/,""))})):void 0},f=function(t){return setTimeout(function(){var r,o;return r=e(t.currentTarget),o=r.val(),o=v(o),o=e.payment.formatExpiry(o),y(o,r)})},c=function(t){var r,o,n;return o=String.fromCharCode(t.which),/^\d+$/.test(o)?(r=e(t.currentTarget),n=r.val()+o,/^\d$/.test(n)&&"0"!==n&&"1"!==n?(t.preventDefault(),setTimeout(function(){return r.val("0"+n+" / ")})):/^\d\d$/.test(n)?(t.preventDefault(),setTimeout(function(){var e,t;return e=parseInt(n[0],10),t=parseInt(n[1],10),t>2&&0!==e?r.val("0"+e+" / "+t):r.val(""+n+" / ")})):void 0):void 0},l=function(t){var r,o,n;return o=String.fromCharCode(t.which),/^\d+$/.test(o)?(r=e(t.currentTarget),n=r.val(),/^\d\d$/.test(n)?r.val(""+n+" / "):void 0):void 0},d=function(t){var r,o,n;return n=String.fromCharCode(t.which),"/"===n||" "===n?(r=e(t.currentTarget),o=r.val(),/^\d$/.test(o)&&"0"!==o?r.val("0"+o+" / "):void 0):void 0},i=function(t){var r,o;return r=e(t.currentTarget),o=r.val(),8!==t.which||null!=r.prop("selectionStart")&&r.prop("selectionStart")!==o.length?void 0:/\d\s\/\s$/.test(o)?(t.preventDefault(),setTimeout(function(){return r.val(o.replace(/\d\s\/\s$/,""))})):void 0},_=function(t){return setTimeout(function(){var r,o;return r=e(t.currentTarget),o=r.val(),o=v(o),o=o.replace(/\D/g,"").slice(0,4),y(o,r)})},b=function(e){var t;return e.metaKey||e.ctrlKey?!0:32===e.which?!1:0===e.which?!0:e.which<33?!0:(t=String.fromCharCode(e.which),!!/[\d\s]/.test(t))},k=function(r){var o,n,a,i;return o=e(r.currentTarget),a=String.fromCharCode(r.which),/^\d+$/.test(a)&&!u(o)?(i=(o.val()+a).replace(/\D/g,""),n=t(i),n?i.length<=n.length[n.length.length-1]:i.length<=16):void 0},g=function(t){var r,o,n;return r=e(t.currentTarget),o=String.fromCharCode(t.which),/^\d+$/.test(o)&&!u(r)?(n=r.val()+o,n=n.replace(/\D/g,""),n.length>6?!1:void 0):void 0},$=function(t){var r,o,n;return r=e(t.currentTarget),o=String.fromCharCode(t.which),/^\d+$/.test(o)&&!u(r)?(n=r.val()+o,n.length<=4):void 0},q=function(t){var r,n,a,i,s;return r=e(t.currentTarget),s=r.val(),i=e.payment.cardType(s)||"unknown",r.hasClass(i)?void 0:(n=function(){var e,t,r;for(r=[],e=0,t=o.length;t>e;e++)a=o[e],r.push(a.type);return r}(),r.removeClass("unknown"),r.removeClass(n.join(" ")),r.addClass(i),r.toggleClass("identified","unknown"!==i),r.trigger("payment.cardType",i))},e.payment.fn.formatCardCVC=function(){return this.on("keypress",b),this.on("keypress",$),this.on("paste",_),this.on("change",_),this.on("input",_),this},e.payment.fn.formatCardExpiry=function(){return this.on("keypress",b),this.on("keypress",g),this.on("keypress",c),this.on("keypress",d),this.on("keypress",l),this.on("keydown",i),this.on("change",f),this.on("input",f),this},e.payment.fn.formatCardNumber=function(){return this.on("keypress",b),this.on("keypress",k),this.on("keypress",s),this.on("keydown",a),this.on("keyup",q),this.on("paste",p),this.on("change",p),this.on("input",p),this.on("input",q),this},e.payment.fn.restrictNumeric=function(){return this.on("keypress",b),this.on("paste",h),this.on("change",h),this.on("input",h),this},e.payment.fn.cardExpiryVal=function(){return e.payment.cardExpiryVal(e(this).val())},e.payment.cardExpiryVal=function(e){var t,r,o,n;return n=e.split(/[\s\/]+/,2),t=n[0],o=n[1],2===(null!=o?o.length:void 0)&&/^\d+$/.test(o)&&(r=(new Date).getFullYear(),r=r.toString().slice(0,2),o=r+o),t=parseInt(t,10),o=parseInt(o,10),{month:t,year:o}},e.payment.validateCardNumber=function(e){var r,o;return e=(e+"").replace(/\s+|-/g,""),/^\d+$/.test(e)?(r=t(e),r?(o=e.length,x.call(r.length,o)>=0&&(r.luhn===!1||m(e))):!1):!1},e.payment.validateCardExpiry=function(t,r){var o,n,a;return"object"==typeof t&&"month"in t&&(a=t,t=a.month,r=a.year),t&&r?(t=e.trim(t),r=e.trim(r),/^\d+$/.test(t)&&/^\d+$/.test(r)&&t>=1&&12>=t?(2===r.length&&(r=70>r?"20"+r:"19"+r),4!==r.length?!1:(n=new Date(r,t),o=new Date,n.setMonth(n.getMonth()-1),n.setMonth(n.getMonth()+1,1),n>o)):!1):!1},e.payment.validateCardCVC=function(t,o){var n,a;return t=e.trim(t),/^\d+$/.test(t)?(n=r(o),null!=n?(a=t.length,x.call(n.cvcLength,a)>=0):t.length>=3&&t.length<=4):!1},e.payment.cardType=function(e){var r;return e?(null!=(r=t(e))?r.type:void 0)||null:null},e.payment.formatCardNumber=function(r){var o,n,a,i;return r=r.replace(/\D/g,""),(o=t(r))?(a=o.length[o.length.length-1],r=r.slice(0,a),o.format.global?null!=(i=r.match(o.format))?i.join(" - "):void 0:(n=o.format.exec(r),null!=n?(n.shift(),n=e.grep(n,function(e){return e}),n.join(" - ")):void 0)):r},e.payment.formatExpiry=function(e){var t,r,o,n;return(r=e.match(/^\D*(\d{1,2})(\D+)?(\d{1,4})?/))?(t=r[1]||"",o=r[2]||"",n=r[3]||"",n.length>0?o=" / ":" /"===o?(t=t.substring(0,1),o=""):2===t.length||o.length>0?o=" / ":1===t.length&&"0"!==t&&"1"!==t&&(t="0"+t,o=" / "),t+o+n):""}}.call(this);var RespTabs={};!function(e){"use strict";e.fn.responsiveTabs=function(){return this.each(function(){var e=Object.create(RespTabs);e.init(this)})}}(jQuery),RespTabs.init=function(e){var t=$(e).children();$headers=t.children(":header"),$contents=t.children("div"),$headers.addClass("resp-headings"),$contents.addClass("resp-contents");var r=$('[resp-tab="default"]');r.length||(r=t.first()),r.children("div").addClass("resp-content__active").attr("aria-hidden","false"),$contents.not(".resp-content__active").hide().attr("aria-hidden","true"),r.children(":header").addClass("resp-heading__active");var o=$("<ul></ul>",{"class":"resp-tablist"}),n=$("<select></select>",{"class":"resp-tabDrop"}),a=1;$headers.each(function(){var e=$(this),r=$(this).next(),i=$("<option></option>",{"class":"resp-tabDropOption",id:"tabOption"+a,text:e.text()}),s=$("<li></li>",{"class":"resp-tablistItem",id:"tablistItem"+a,text:e.text(),click:function(){t.find(".resp-content__active").toggle().removeClass("resp-content__active").attr("aria-hidden","true").prev().removeClass("resp-heading__active"),r.toggle().addClass("resp-content__active").attr("aria-hidden","false"),e.addClass("resp-heading__active"),o.find(".resp-tablistItem__active").removeClass("resp-tablistItem__active"),s.addClass("resp-tablistItem__active"),$(".resp-tabDropOption").removeAttr("selected"),$(".resp-tabDropOption").eq($(".resp-tablistItem__active").index()).attr("selected","selected")}});r.hasClass("resp-content__active")&&s.addClass("resp-tablistItem__active"),o.append(s),n.append(i),n.change(function(){t.find(".resp-content__active").toggle().removeClass("resp-content__active").attr("aria-hidden","true").prev().removeClass("resp-heading__active"),$(".resp-contents").eq($(".resp-tabDrop :selected").index()).toggle().addClass("resp-content__active").attr("aria-hidden","false"),$(".resp-headings").eq($(".resp-tabDrop :selected").index()).addClass("resp-heading__active"),$(".resp-tablistItem").removeClass("resp-tablistItem__active"),$(".resp-tablistItem").eq($(".resp-tabDrop :selected").index()).addClass("resp-tablistItem__active")}),a++}),$(document).ready(function(){$(".resp-tabDropOption").eq(r.index()).attr("selected","selected")}),t.parent().before(o),t.parent().before(n)};
